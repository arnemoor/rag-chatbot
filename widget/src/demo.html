<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AutoRAG Widget Demo - Button Text Test</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        padding: 40px 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        padding: 40px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #1e293b;
        margin-bottom: 30px;
        text-align: center;
      }

      .control-panel {
        background: #f8fafc;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 30px;
      }

      .control-group {
        margin-bottom: 20px;
      }

      .control-group label {
        display: block;
        font-weight: 600;
        color: #475569;
        margin-bottom: 8px;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .control-group input,
      .control-group select {
        width: 100%;
        padding: 10px 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.2s;
      }

      .control-group input:focus,
      .control-group select:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        flex: 1;
      }

      .btn-primary {
        background: #2563eb;
        color: white;
      }

      .btn-primary:hover {
        background: #1d4ed8;
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: #ef4444;
        color: white;
      }

      .btn-secondary:hover {
        background: #dc2626;
        transform: translateY(-1px);
      }

      .info-box {
        background: #fef3c7;
        border: 2px solid #fbbf24;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 20px;
      }

      .info-box p {
        color: #92400e;
        margin: 0;
        font-size: 14px;
        line-height: 1.6;
      }

      .preview-area {
        background: #f8fafc;
        border-radius: 12px;
        padding: 24px;
        min-height: 200px;
        position: relative;
      }

      .preview-title {
        font-size: 12px;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 16px;
        font-weight: 600;
      }

      .code-display {
        background: #1e293b;
        color: #e2e8f0;
        padding: 20px;
        border-radius: 8px;
        font-family: 'Monaco', 'Menlo', monospace;
        font-size: 13px;
        line-height: 1.6;
        overflow-x: auto;
        margin-top: 30px;
      }

      .code-display .comment {
        color: #64748b;
      }

      .code-display .tag {
        color: #ef4444;
      }

      .code-display .attr {
        color: #10b981;
      }

      .code-display .value {
        color: #fbbf24;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸŽ¯ AutoRAG Widget Demo</h1>

      <div class="info-box">
        <p>
          <strong>Note:</strong>
          This demo shows the widget in minimized (button) mode. Configure the button text and other parameters below,
          then click "Apply Changes" to see the widget update. The widget appears in the bottom-right corner by default.
        </p>
      </div>

      <div class="control-panel">
        <h2 style="margin-bottom: 20px; color: #1e293b">Widget Configuration</h2>

        <div class="control-group">
          <label for="button-text">Button Text</label>
          <input type="text" id="button-text" value="Chat with AI" placeholder="Enter button text" />
        </div>

        <div class="control-group">
          <label for="header-title">Header Title</label>
          <input type="text" id="header-title" value="AI Assistant" placeholder="Enter header title" />
        </div>

        <div class="control-group">
          <label for="language">Language</label>
          <select id="language">
            <!-- Will be populated dynamically -->
          </select>
        </div>

        <div class="control-group">
          <label for="category">Category</label>
          <select id="category" onchange="updateProducts()">
            <!-- Will be populated dynamically -->
          </select>
        </div>

        <div class="control-group">
          <label for="product">Product</label>
          <select id="product">
            <!-- Will be populated dynamically -->
          </select>
        </div>

        <div class="control-group">
          <label for="provider">Provider</label>
          <select id="provider" onchange="updateModels()">
            <!-- Will be populated dynamically -->
          </select>
        </div>

        <div class="control-group">
          <label for="model">Model</label>
          <select id="model">
            <!-- Will be populated dynamically -->
          </select>
        </div>

        <div class="control-group">
          <label for="theme">Theme</label>
          <select id="theme">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
        </div>

        <div class="control-group">
          <label for="position">Position</label>
          <select id="position">
            <option value="bottom-right">Bottom Right</option>
            <option value="bottom-left">Bottom Left</option>
            <option value="top-right">Top Right</option>
            <option value="top-left">Top Left</option>
          </select>
        </div>

        <div class="button-group">
          <button class="btn btn-primary" onclick="applyChanges()">Apply Changes</button>
          <button class="btn btn-secondary" onclick="resetWidget()">Reset Widget</button>
        </div>
      </div>

      <div class="code-display" id="embed-code">
        <!-- Will be populated dynamically -->
      </div>
    </div>

    <!-- Widget will be added here dynamically -->
    <div id="widget-container"></div>

    <script src="autorag-widget.min.js"></script>
    <script>
      let currentWidget = null;
      let apiUrl = null;
      let categories = [];
      let productsByCategory = {};
      let providers = [];
      let modelsByProvider = {};

      // Initialize on page load
      window.addEventListener('DOMContentLoaded', async () => {
        await loadConfiguration();
        createWidget();
      });

      async function loadConfiguration() {
        // Try to get API URL from deployment config
        try {
          const response = await fetch('/deployment-config.json');
          if (response.ok) {
            const config = await response.json();
            apiUrl = config.worker_url || window.location.origin;
          } else {
            apiUrl = window.location.origin;
          }
        } catch (e) {
          apiUrl = window.location.origin;
        }

        // Load languages
        try {
          const langResponse = await fetch(`${apiUrl}/config/languages`);
          if (langResponse.ok) {
            const languages = await langResponse.json();
            const languageSelect = document.getElementById('language');
            languageSelect.innerHTML = '';
            
            for (const lang of languages) {
              const option = document.createElement('option');
              option.value = lang.code;
              option.textContent = lang.nativeName || lang.name;
              languageSelect.appendChild(option);
            }
          }
        } catch (error) {
          console.error('Failed to load languages:', error);
        }
        
        // Load categories
        try {
          const catResponse = await fetch(`${apiUrl}/config/categories`);
          if (catResponse.ok) {
            categories = await catResponse.json();
            const categorySelect = document.getElementById('category');
            categorySelect.innerHTML = '';
            
            for (const cat of categories) {
              const option = document.createElement('option');
              option.value = cat.id;
              option.textContent = cat.name;
              categorySelect.appendChild(option);
            }
            
            // Load products for each category
            for (const cat of categories) {
              const prodResponse = await fetch(`${apiUrl}/config/products?category=${cat.id}`);
              if (prodResponse.ok) {
                const products = await prodResponse.json();
                productsByCategory[cat.id] = products;
              }
            }
            
            // Initialize first category's products
            if (categories.length > 0) {
              updateProducts();
            }
          }
        } catch (error) {
          console.error('Failed to load configuration:', error);
        }
        
        // Load providers and models
        try {
          const provResponse = await fetch(`${apiUrl}/config/providers`);
          if (provResponse.ok) {
            providers = await provResponse.json();
            const providerSelect = document.getElementById('provider');
            providerSelect.innerHTML = '';
            
            for (const prov of providers) {
              const option = document.createElement('option');
              option.value = prov.id;
              option.textContent = prov.name;
              providerSelect.appendChild(option);
            }
            
            // Load models for first provider
            if (providers.length > 0) {
              await updateModels();
            }
          }
        } catch (error) {
          console.error('Failed to load providers:', error);
        }
      }

      function updateProducts() {
        const categoryId = document.getElementById('category').value;
        const productSelect = document.getElementById('product');
        productSelect.innerHTML = '';
        
        const products = productsByCategory[categoryId] || [];
        for (const prod of products) {
          const option = document.createElement('option');
          option.value = prod.id;
          option.textContent = prod.name;
          productSelect.appendChild(option);
        }
      }

      async function updateModels() {
        const providerId = document.getElementById('provider').value;
        const modelSelect = document.getElementById('model');
        modelSelect.innerHTML = '';
        
        try {
          // Get all models from API
          const modelsResponse = await fetch(`${apiUrl}/config/models`);
          if (modelsResponse.ok) {
            const allModels = await modelsResponse.json();
            
            // Find the selected provider
            const provider = providers.find(p => p.id === providerId);
            if (provider && provider.models) {
              // Add models for this provider
              for (const modelId of provider.models) {
                const modelInfo = allModels[modelId];
                if (modelInfo && modelInfo.available) {
                  const option = document.createElement('option');
                  option.value = modelId;
                  option.textContent = modelInfo.displayName || modelId;
                  modelSelect.appendChild(option);
                }
              }
            }
          }
        } catch (error) {
          console.error('Failed to load models:', error);
          // Add a default model as fallback
          const option = document.createElement('option');
          option.value = '@cf/meta/llama-3.2-3b-instruct';
          option.textContent = 'Llama 3.2 3B Instruct';
          modelSelect.appendChild(option);
        }
      }

      function createWidget() {
        // Remove existing widget if any
        if (currentWidget) {
          currentWidget.remove();
        }

        // Create new widget
        currentWidget = document.createElement('autorag-widget');

        // Apply all configurations
        const buttonText = document.getElementById('button-text').value;
        const headerTitle = document.getElementById('header-title').value;
        const language = document.getElementById('language').value;
        const category = document.getElementById('category').value;
        const product = document.getElementById('product').value;
        const provider = document.getElementById('provider').value;
        const model = document.getElementById('model').value;
        const theme = document.getElementById('theme').value;
        const position = document.getElementById('position').value;

        currentWidget.setAttribute('button-text', buttonText);
        currentWidget.setAttribute('header-title', headerTitle);
        currentWidget.setAttribute('language', language);
        currentWidget.setAttribute('category', category);
        currentWidget.setAttribute('product', product);
        currentWidget.setAttribute('provider', provider);
        currentWidget.setAttribute('model', model);
        currentWidget.setAttribute('theme', theme);
        currentWidget.setAttribute('position', position);

        // Add to page
        document.getElementById('widget-container').appendChild(currentWidget);

        // Update embed code
        updateEmbedCode();
      }

      function updateEmbedCode() {
        const buttonText = document.getElementById('button-text').value;
        const headerTitle = document.getElementById('header-title').value;
        const language = document.getElementById('language').value;
        const category = document.getElementById('category').value;
        const product = document.getElementById('product').value;
        const provider = document.getElementById('provider').value;
        const model = document.getElementById('model').value;
        const theme = document.getElementById('theme').value;
        const position = document.getElementById('position').value;

        const code = `<span class="comment"><!-- AutoRAG Widget --></span>
<span class="tag">&lt;script</span> <span class="attr">src</span>=<span class="value">"./autorag-widget.min.js"</span><span class="tag">&gt;&lt;/script&gt;</span>
<span class="tag">&lt;autorag-widget</span>
  <span class="attr">button-text</span>=<span class="value">"${buttonText}"</span>
  <span class="attr">header-title</span>=<span class="value">"${headerTitle}"</span>
  <span class="attr">language</span>=<span class="value">"${language}"</span>
  <span class="attr">category</span>=<span class="value">"${category}"</span>
  <span class="attr">product</span>=<span class="value">"${product}"</span>
  <span class="attr">provider</span>=<span class="value">"${provider}"</span>
  <span class="attr">model</span>=<span class="value">"${model}"</span>
  <span class="attr">theme</span>=<span class="value">"${theme}"</span>
  <span class="attr">position</span>=<span class="value">"${position}"</span><span class="tag">&gt;</span>
<span class="tag">&lt;/autorag-widget&gt;</span>`;

        document.getElementById('embed-code').innerHTML = code;
      }

      function applyChanges() {
        createWidget();
      }

      function resetWidget() {
        document.getElementById('button-text').value = 'Chat with AI';
        document.getElementById('header-title').value = 'AI Assistant';
        // Reset dropdowns to first option
        const selects = ['language', 'category', 'product', 'theme', 'position'];
        selects.forEach(id => {
          const select = document.getElementById(id);
          if (select && select.options.length > 0) {
            select.selectedIndex = 0;
          }
        });
        createWidget();
      }
    </script>
  </body>
</html>
